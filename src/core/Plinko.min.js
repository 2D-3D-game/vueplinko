import e from"matter-js";import*as t from"pixi.js";export function Plinko(i){let l=e.Engine;e.Render;let n=e.Runner,o=e.Bodies,a=e.Body,$=e.Composite,s=e.Events,r=i.offsetWidth,c=i.offsetHeight,d=l.create();d.timing.timeScale=1;let _=[],f=new t.Application({backgroundAlpha:0,resizeTo:i,width:r,height:r,antialias:!0,resolution:2,autoDensity:!0}),p=1.2;f.stage.scale.set(p),i.appendChild(f.view),f.ticker.add(()=>{_.forEach(e=>{e.sprite.position=e.body.position,e.sprite.rotation=e.body.angle})}),n.run(d),s.on(d,"collisionStart",function e(t){let i=t.pairs;for(let l=0;l<i.length;l++){let n=i[l].bodyA,o=i[l].bodyB;"point"===n.label&&new V(n),"point"===o.label&&new V(o),"particle"===n.label&&"point"===o.label&&A(n,o),"particle"===o.label&&"point"===n.label&&A(o,n),"basket"===n.label&&"particle"===o.label&&(k(o),new G(n),F(n)),"basket"===o.label&&"particle"===n.label&&(k(n),new G(o),F(o))}});let u=1e4,g=[],h=[],x=0,y=[2.1,1.2,1,.8,.5,.8,1,1.2,2.1],m=[.00390625,.03125,.109375,.21875,.2734375,.21875,.109375,.03125,.00390625,],b=0,w=8;function S(e,i,l,n=13882323){let a=o.circle(e,i,8,{isStatic:!0});a.label="point",$.add(d.world,a);let s=new t.Graphics;s.beginFill(n),s.drawCircle(e,i,8),s.zIndex=2,s.endFill(),f.stage.addChild(s),h.push([e,i,8])}function C(e,i,l,n){let a=o.circle(e,i,l,{restitution:0,friction:0,collisionFilter:{group:-1}});a.label="particle",a.road={list:n,id:[]},$.add(d.world,a);let s=t.Texture.from("/ball.png?8"),r=new t.Sprite(s);r.width=24,r.height=24,r.pivot.set(24,24),f.stage.addChild(r),_.push({body:a,sprite:r})}function v(e,i,l,n){let a=o.rectangle(e,i,l,l,{isStatic:!0});if(a.label="basket",$.add(d.world,a),void 0===n)return;let s=T(n),c=new t.Graphics;c.beginFill(s),c.drawRoundedRect(-l/2,-l/4,l-4,l/2,10*l/60),c.endFill();let p=new t.TextStyle({fontFamily:"Arial",fontSize:14,fill:"#ffffff",align:"center"}),u=new t.Text(n+"x",p);u.anchor.set(.5,.5);let g=new t.Container;g.position.x=e,g.position.y=i,g.interactive=!0,g.buttonMode=!0,g.addChild(c),g.addChild(u),_.push({body:a,sprite:g}),f.stage.addChild(g),g.on("mousedown",function(t){P(w,function e(t,i){let l=0;for(let n=0;n<y.length;n++)y[n]===t&&(l=i<=r/2?y.length-n:n+1);return l}(n,e))}),a.metter={text:n,color:s,x:e,y:i,gap:l}}function R(e,i,l,n){let a=o.rectangle(e,i,l,l,{isStatic:!0});if(a.label="scoreboard",$.add(d.world,a),void 0===n)return;let s=T(n),r=new t.Graphics;r.beginFill(s),r.drawRoundedRect(e+2-l/2,i-l/4,l-4,l/2,10*l/120),r.endFill();let c=new t.Text(n+"x",{fontSize:12*l/60+"px",fill:"#ffffff"});c.anchor.set(.5),c.x=e,c.y=i,f.stage.addChild(r),f.stage.addChild(c),a.metter={text:n,color:s,x:e,y:i,gap:l}}function k(e){for(let t=0;t<_.length;t++)_[t].body.id===e.id&&($.remove(d.world,_[t].body),f.stage.removeChild(_[t].sprite),_.splice(t,1))}function F(e){let t=e.metter.text;u+=(t-1)*100,g.push(t);let i=Math.max(g.length-4,0),l=g.slice(i);for(let n=0;n<l.length;n++)R(r-40,(c/2+30*(n-2))/p,50,l[n])}function V(e){let i=new t.Graphics;var l,n=0,o=.7,a=.06666666666666667/1.2;!function t(){if(i.clear(),localStorage.getItem("style")&&"light"==localStorage.getItem("style")?i.lineStyle(n,11722279,o):i.lineStyle(n,16777215,o),i.lineStyle(n,11722279,o),i.beginFill(0,0),i.drawCircle(e.position.x,e.position.y,2*e.circleRadius),i.endFill(),f.stage.addChild(i),15===n){cancelAnimationFrame(l),l=void 0;return}n+=2,o-=a,l=requestAnimationFrame(t)}(),setTimeout(()=>{f.stage.removeChild(i)},400)}function G(e){let i=new t.Graphics;var l,n=0,o=.7,a=.06666666666666667/1.2;!function t(){i.clear(),localStorage.getItem("style")&&localStorage.getItem("style"),i.lineStyle(n,e.metter.color,o),i.beginFill(0,0);let $=e.position.x-30,s=e.position.y-20;if(i.drawRoundedRect($,s,60,40,10),i.endFill(),f.stage.addChild(i),15===n){cancelAnimationFrame(l),l=void 0;return}n+=1,o-=a,l=requestAnimationFrame(t)}(),setTimeout(()=>{f.stage.removeChild(i)},400)}function I(e,t){return e*(e-1)/2+(e-1)*2+t}function T(e){let t=332316;switch(parseFloat(e)){case 10:case parseFloat("25.1"):case parseFloat("100"):case 7.2:case parseFloat("15.9"):case parseFloat("51.8"):case 5.6:case parseFloat("11.2"):case parseFloat("31.4"):t=16392766;break;case 3.6:case parseFloat("6.01"):case parseFloat("13.0"):t=16396335;break;case 2.1:case parseFloat("2.83"):case parseFloat("4.41"):t=16405028;break;case 1.2:case parseFloat("1.29"):case parseFloat("1.44"):t=16410654;break;case 1:t=16419856;break;case .8:case parseFloat("0.732"):case parseFloat("0.640"):t=16424972;break;case .5:case parseFloat("0.379"):case parseFloat("0.250"):default:t=16433152}return t}function z(e){let t=0;for(let i=0;i<y.length;i++)y[i]===e&&(t=i);return m[t]}function A(e,t){if(a.setStatic(e,!0),e.road.id.includes(t.id))setTimeout(()=>{a.setVelocity(e,{x:.5>Math.random()?-1:1,y:-3.5})},0);else{let i=e.road.list.shift();x++,0===i?(setTimeout(()=>{a.setVelocity(e,{x:-3.2,y:-1.6+Math.random()})},0),d.timing.timeScale=1.2):1===i?(setTimeout(()=>{a.setVelocity(e,{x:3.2,y:-1.6+Math.random()})},0),d.timing.timeScale=1.2):2===i?(a.setPosition(e,{x:t.position.x,y:t.position.y-2*t.circleRadius}),setTimeout(()=>{a.setVelocity(e,{x:-1,y:-3.2})},0),d.timing.timeScale=1.5):3===i?(a.setPosition(e,{x:t.position.x,y:t.position.y-2*t.circleRadius}),setTimeout(()=>{a.setVelocity(e,{x:1,y:-3.2})},0),d.timing.timeScale=1.5):4===i?(setTimeout(()=>{a.setVelocity(e,{x:.7,y:0})},0),d.timing.timeScale=1.5):5===i?(setTimeout(()=>{a.setVelocity(e,{x:-.7,y:0})},0),d.timing.timeScale=1.5):(a.setPosition(e,{x:t.position.x,y:t.position.y-2*t.circleRadius}),setTimeout(()=>{a.setVelocity(e,{x:0,y:-3.5})},0),d.timing.timeScale=1.5),e.road.id.push(t.id)}a.setStatic(e,!1)}function P(e,t){let[i,l]=function e(t,i){let l=0,n=[],o=[],a=i-1,$=t+1-i,s=I(t,i);for(let r=t;r>0;r--){let c=a>0&&Math.random()>.5?0:1;0===$&&(c=0),0===c&&(6==(b=.5>Math.random()?1:3)&&(l=3),a--),1===c&&(6==(b=.5>Math.random()?0:2)&&(l=2),$--),s+=c,n.push(s),1===b||0===b?o.push(b,b+4):6===b?o.push(b,l):o.push(b),s-=r+2}return[n,o]}(e,t);new C(r/2,0,12,l)}return{map:function e(t,i){f.stage.position._x=0;let l=3;for(let n=1;n<=t.length;n++){let o=(r-60*l)/2;for(let a=1;a<=l;a++)n<t.length?new S(o+60*a-30,60*n,10):a>1&&new v(o+60*a-30,60*n,60,t[a-2]);l+=1}p=9/t.length,f.stage.scale.set(p),f.stage.position._x+=(1-p)*r/2,void 0!==i&&(m=i,y=t)},add:P,clear:function e(){$.clear(d.world),f.stage.removeChildren()},getRowNum:function e(t){void 0!==t&&(w=t-1)}}}